var app=angular.module("pakit",["ui.router","google.places","angular-storage","ngMap","firebase","ngFileUpload","cloudinary"]);app.constant("ENDPOINT_URI","https://api.justpakit.com/api/"),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,e,a,r){t.state("landing",{url:"/",templateUrl:"partials/landing.html"}).state("signup",{url:"/signup",templateUrl:"partials/signup.html",controller:"signupController"}).state("login",{url:"/login",templateUrl:"partials/login.html",controller:"loginController"}).state("mobile-otp",{url:"/otp-verification",templateUrl:"partials/mobile-otp.html",controller:"mobileOtpController"}).state("navbar",{url:"/dashboard",templateUrl:"partials/navbar.html",controller:"navController"}).state("navbar.home",{url:"/home",templateUrl:"partials/home.html"}).state("navbar.my_posting",{url:"/my_posting",templateUrl:"partials/my_posting.html",controller:"myPostingController",params:{data:""}}).state("navbar.card_navbar",{url:"/card_nav",templateUrl:"partials/card_navbar.html",controller:"cardNavController",params:{post:"",data:"",goto:"",connected:""}}).state("navbar.card_navbar.connected_users",{url:"/connected",templateUrl:"partials/connected_users.html"}).state("navbar.card_navbar.allusers_grid",{url:"/allusers_grid",templateUrl:"partials/allusers_grid.html"}).state("navbar.card_navbar.allusers_details",{url:"/allusers_details",templateUrl:"partials/allusers_details.html"}).state("navbar.main",{url:"/main",templateUrl:"partials/main.html",controller:["$scope","$state",function(t,e){t.goTo=function(t,a){a.preventDefault(),e.transitionTo("navbar.main."+t)}}]}).state("navbar.main.opt1",{url:"/opt1",templateUrl:"partials/opt1.html",controller:"opt1Controller"}).state("navbar.main.opt2",{url:"/opt2",templateUrl:"partials/opt2.html",controller:"opt2Controller"}).state("navbar.main.opt3",{url:"/opt3",templateUrl:"partials/opt3.html",controller:"opt3Controller"}).state("navbar.main.opt4",{url:"/opt4",templateUrl:"partials/opt4.html"}).state("navbar.view1",{url:"/view1",templateUrl:"partials/view1.html",controller:"view1Controller",params:{data:""}}).state("404",{url:"/404",template:"<h1>Page not found!</h1>"}).state("navbar.card_navbar.checkout",{url:"/checkout",templateUrl:"partials/checkout.html",controller:"checkoutController"}).state("navbar.account",{url:"/account",templateUrl:"partials/account.html",resolve:{formData:["APIService",function(t){return t.call_get("user/me")}]},controller:"accountController",params:{data:""}}).state("navbar.account.account_form",{url:"/account_form",templateUrl:"partials/account_form.html",controller:"formController"}).state("navbar.account.account_profile",{url:"/account_profile",templateUrl:"partials/account_profile.html",controller:"accountProfileController"}).state("navbar.account.past_trips",{url:"/past_trips",templateUrl:"partials/past_trips.html"}).state("navbar.account.contact",{url:"/contact",templateUrl:"partials/contact.html"}).state("navbar.account.terms",{url:"/terms",templateUrl:"partials/terms.html"}).state("navbar.account.faq",{url:"/faq",templateUrl:"partials/faq.html"}),e.otherwise("/404"),a.html5Mode(!0),r.interceptors.push("APIInterceptor")}]).config(["cloudinaryProvider",function(t){t.set("cloud_name","pakitcloud").set("upload_preset","rer5u8uy")}]).service("APIInterceptor",["$rootScope","UserService",function(t,e){var a=this;a.request=function(a){var r=e.getCurrentUser(),n=r?r.access_token:null;return n&&!t.isUpload&&(a.headers.authorization=n),(t.isUpload||void 0===t.isUpload)&&(t.isUpload=!1),a},a.responseError=function(e){return 401===e.status&&t.$broadcast("unauthorized"),e}}]).service("UserService",["store",function(t){var e=this,a=null;e.setCurrentUser=function(e){return a=e,t.set("user",e),a},e.getCurrentUser=function(){return a||(a=t.get("user")),a}}]).service("APIService",["$http","ENDPOINT_URI",function(t,e){var a=this;a.call_get=function(a){return t.get(e+a)},a.call_post=function(a,r){return t.post(e+a,r)}}]),app.factory("formService",["$http",function(t){var e={};return{getFormData:function(){return e},setFormData:function(t){e=t}}}]),app.factory("ChatService",(t,e)=>{const a={},r=firebase.database().ref().child("chat_rooms");return{initChat(t){a[t]||r.once("value",e=>{e.hasChild(t)||r.child(t).child("test").set({0:0}),r.child(t).on("value",function(e){a[t]=e.val()})})},getChatList:()=>a,sendMessage(t,e){r.child(e.timestamp).update(e)}}}),(app=angular.module("pakit")).controller("formController",["$state","$scope","APIService","UserService","$stateParams","formData",function(t,e,a,r,n,o){var s=o.data;e.acc=o.data,e.accUpdate=function(){s.education=e.acc.education||"",s.workplace=e.acc.workplace||"",s.hometown=e.acc.hometown||"",s.bank_num=e.acc.bank_num||"",a.call_post("user/me",s).then(function(t){t.status})}}]),(app=angular.module("pakit")).controller("accountController",["$state","$scope","APIService","UserService","$stateParams","formData",function(t,e,a,r,n,o){o.data;"navbar.account"==t.current.name&&t.go("navbar.account.account_profile"),e.User=n.data||{},e.account_form=function(){t.go("navbar.account.account_form")},e.goProfile=function(){t.go("navbar.account.account_profile")},e.goPast=function(){t.go("navbar.account.past_trips")},e.goFaq=function(){t.go("navbar.account.faq")},e.goTerms=function(){t.go("navbar.account.terms")},e.goContact=function(){t.go("navbar.account.contact")}}]),app.controller("accountProfileController",["$scope","$rootScope","Upload","cloudinary","APIService",function(t,e,a,r,n){t.upload=function(){if(t.form.file.$valid&&t.file){e.isUpload=!0;const o=new Date,s="Image ("+o.getDate()+" - "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+")";a.upload({url:"https://api.cloudinary.com/v1_1/"+r.config().cloud_name+"/upload",data:{upload_preset:r.config().upload_preset,tags:"pakit",context:"photo="+s,file:t.file}}).then(function(e){n.call_post("user/pic",{picUrl:e.data.url}).then(function(e){200==e.status&&(t.picUrl=e.data.url)})},function(t){})}}}]),(app=angular.module("pakit")).controller("cardNavController",["$state","$scope","$stateParams","APIService","UserService","ChatService",function(t,e,a,r,n,o){e.currCard={},e.initChat=function(t){o.initChat(t)};var s=a.post||"empty";if("empty"!=s&&s.success){e.currCard.date=s.date,e.currCard.from=s.src_airport.airport_code,e.currCard.to=s.des_airport.airport_code,e.currCard.weight=s.weight,e.currCard.mode=s.type,e.currCard.id=s.id,e.avatar="";var c="../image/";"flight"==e.currCard.mode?e.avatar=c+"flight.png":"travel"==e.currCard?e.avatar=c+"travel.png":e.avatar=c+"send.png","navbar.card_navbar"==t.current.name&&s.success&&t.go("navbar.card_navbar"+a.goto)}var l=a.connected.transactions||"empty";if("empty"!=l){e.connected_users=l[0].concat(l[1]);for(var i=n.getCurrentUser(),u=0;u<e.connected_users.length;u++)e.connected_users[u].initiated_by.email==i.email?e.connected_users[u].name=e.connected_users[u].initiated_for.name:e.connected_users[u].name=e.connected_users[u].initiated_by.name,"send"==e.currCard.mode?(e.connected_users[u].entry=e.connected_users[u].traveller_entry,e.connected_users[u].entry.name="Carrying"):"travel"==e.currCard.mode?(e.connected_users[u].entry=e.connected_users[u].sender_entry,e.connected_users[u].entry.name="Send"):"flight"==e.currCard.mode&&(e.connected_users[u].entry=e.connected_users[u].flight_entry,e.connected_users[u].entry.name="Flight")}e.usersToShow=a.data||[],e.currUser=e.usersToShow[0],e.wayPoints=[{location:{lat:26.1911546,lng:91.6902631},stopover:!0}],e.changeViews=function(e){t.go(e)},e.checkout=function(){t.go("navbar.card_navbar.checkout")},e.showCurrUser=function(a){t.go("navbar.card_navbar.allusers_details"),e.currUser=a},e.showUserDetail=function(t){e.currUser=t},e.inviteUser=function(){var t,a={};"send"==e.currCard.mode?(t="send_transaction/invite/pending/",a.send_id=e.currCard.id,a.initiated_for=e.currUser.id,a.travel_id=e.currUser.travelling_id):"travel"==e.currCard.mode?(t="travel_transaction/invite/pending/",a.send_id=e.currUser.sending_id,a.initiated_for=e.currUser.id,a.travel_id=e.currCard.id):"flight"==e.currCard.mode&&(t="flight_transaction/invite/pending/",a.flight_posted_id=e.currCard.id,a.initiated_for=e.currUser.id),r.call_post(t,a).then(function(t){if(200==t.status){var a=e.usersToShow.indexOf(e.currUser);e.usersToShow.splice(a,1),e.currUser=e.usersToShow[a+1]||{}}})}}]),(app=angular.module("pakit")).controller("account_formController",["$state","$scope","APIService","UserService","$stateParams",function(t,e,a,r,n){}]),angular.module("pakit").controller("loginController",["$rootScope","$scope","$state","formService","APIService","UserService","$firebaseAuth",function(t,e,a,r,n,o,s){const c=s();e.fbLogin=function(){FB.login(function(t){if(!t.authResponse)return;const e=t.authResponse.accessToken,r=firebase.auth.FacebookAuthProvider.credential(e);c.$signInWithCredential(r).then(function(e){const r={email:e.email,name:e.displayName,firebaseToken:e.refreshToken,uid:e.uid,fbId:t.authResponse.userID};n.call_post("user/register/facebook",r).then(function(t){if(200==t.status&&!0===t.data.success){r.access_token=t.data.token,o.setCurrentUser(r);var e={};n.call_get("user/me").then(function(t){200==t.status&&(e.data=t.data,r.name=t.data.name,o.setCurrentUser(r),a.go("navbar",e))}).catch(function(t){})}}).catch(function(t){})}).catch(function(t){})},{scope:"email"})},e.error=!1,e.submit=function(r){n.call_post("user/login/",r).then(function(s){if(200==s.status){r.access_token=s.data.token,e.error=!1,o.setCurrentUser(r),t.$broadcast("authorized");var c={};n.call_get("user/me").then(function(t){200==t.status&&(c.data=t.data,r.name=t.data.name,o.setCurrentUser(r),a.go("navbar",c))})}else 401==s.status&&(e.error=!0)}).catch(function(t){})}}]),(app=angular.module("pakit")).controller("myPostingController",["$scope","$state","$stateParams","APIService",function(t,e,a,r){t.postings=a.data,t.imageType=function(t){var e="../image/";return e+="flight"==t?"flight.png":"travel"==t?"travel.png":"send.png"},test={},t.showPost=function(t){test.post=t;var a={};a.entry_id=t.id;var n="";"send"==t.type?n="search/travellers":"travel"==t.type?n="search/senders":"flight"==t.type&&(n="search/flights"),r.call_post(n,a).then(function(t){200==t.status&&(test.post.success=!0,test.data=t.data,test.goto=".allusers_details",r.call_post(n+"_connected",a).then(function(a){200==t.status&&(test.connected=a.data,e.go("navbar.card_navbar",test))}))})}}]),(app=angular.module("pakit")).controller("navController",["$state","$scope","APIService","UserService","$firebaseAuth","$firebaseObject",function(t,e,a,r,n,o){e.currUser=r.getCurrentUser(),e.image_url="../image/account.svg","navbar"==t.current.name&&t.go("navbar.home"),e.isActive=function(e){return t.includes(e)},e.isActiveOpt=function(e){return t.is(e)},e.getRequest=function(){a.call_get("user/requests").then(function(t){200==t.status&&(e.Requests=t.data.requests)})},e.Requests=[],e.goTo=function(e,a){a.preventDefault(),t.go("navbar."+e)};var s="empty";e.showPostings=function(){"empty"==s?a.call_get("user/trips/").then(function(e){200==e.status&&((s={}).data=e.data,t.go("navbar.my_posting",s))}):t.go("navbar.my_posting",s)},e.account=function(){a.call_get("user/me/").then(function(e){200==e.status&&((s={}).data=e.data,t.go("navbar.account",s,{reload:!0}))})},e.logout=function(){a.call_get("user/logout").then(function(e){200==e.status&&(r.setCurrentUser(null),n().$signOut().then(function(){t.go("login")}))})},e.rejectReq=function(t){var r={};r.transactionID=t._id;var n;n="send_transaction/invite/rejected/",a.call_post(n,r).then(function(a){if(200==a.status){var r=e.Requests.indexOf(t);e.Requests.splice(r,1)}})},e.acceptReq=function(t){var r={};r.transactionID=t._id;var n;n="send_transaction/invite/accepted/",a.call_post(n,r).then(function(a){if(200==a.status){var r=e.Requests.indexOf(t);e.Requests.splice(r,1)}})},e.Notifs=[{name:"My Account",url:"#home"},{name:"Past Trips",url:"#about"},{name:"Contact Us",url:"#contact"},{name:"FAQs",url:"#contact"},{name:"Terms of Service",url:"#home"},{name:"Logout",url:"#about"}]}]),(app=angular.module("pakit")).controller("opt1Controller",["$scope","$filter","$state","formService","APIService","UserService",function(t,e,a,r,n,o){t.form={},t.submit=function(){t.form.flight_number=t.flight_number,t.form.type=t.type,t.form.date=e("date")(t.date,"yyyy-MM-dd"),t.form.weight=t.weight,t.form.from=t.from.geometry.location.lat()+","+t.from.geometry.location.lng(),t.form.to=t.to.geometry.location.lat()+","+t.to.geometry.location.lng();var r=t.form;n.call_post("flight/",r).then(function(t){if(200==t.status){var e={},r={};e.entry_id=t.data.id,n.call_get("flight/"+e.entry_id).then(function(t){200==t.status&&(r.post=t.data,r.post.mode="flight",r.post.success=!0,n.call_post("search/flights",e).then(function(t){200==t.status&&(r.data=t.data,r.goto=".allusers_grid",a.go("navbar.card_navbar",r))}))})}}).catch(function(t){})}}]),(app=angular.module("pakit")).controller("opt2Controller",["$scope","$filter","$state","formService","APIService","UserService",function(t,e,a,r,n,o){t.form={},t.submit=function(){t.form.travelling_from=t.travelling_from.geometry.location.lat()+","+t.travelling_from.geometry.location.lng(),t.form.travelling_to=t.travelling_to.geometry.location.lat()+","+t.travelling_to.geometry.location.lng(),t.form.date=e("date")(t.date,"yyyy-MM-dd"),t.form.weight=t.weight;var r=t.form;n.call_post("travel/",r).then(function(t){if(200==t.status){var e={},r={};e.entry_id=t.data.id,n.call_get("travel/"+e.entry_id).then(function(t){200==t.status&&(r.post=t.data,r.post.mode="travel",r.post.success=!0,n.call_post("search/senders",e).then(function(t){200==t.status&&(r.data=t.data,r.goto=".allusers_grid",a.go("navbar.card_navbar",r))}))})}}).catch(function(t){})}}]),(app=angular.module("pakit")).controller("opt3Controller",["$scope","$filter","$state","formService","APIService","UserService",function(t,e,a,r,n,o){t.form={},t.submit=function(){t.form.delivery_location=t.delivery_loc.geometry.location.lat()+","+t.delivery_loc.geometry.location.lng(),t.form.pickup_location=t.pickup_loc.geometry.location.lat()+","+t.pickup_loc.geometry.location.lng(),t.form.date=e("date")(t.date,"yyyy-MM-dd"),t.form.weight=t.weight;var r=t.form;n.call_post("send/",r).then(function(t){if(200==t.status){var e={},r={};e.entry_id=t.data.id,n.call_get("send/"+t.data.id).then(function(t){200==t.status&&(r.post=t.data,r.post.success=!0,r.post.mode="send",n.call_post("search/travellers",e).then(function(t){200==t.status&&(r.data=t.data,r.goto=".allusers_details",a.go("navbar.card_navbar",r))}))})}}).catch(function(t){})}}]),angular.module("pakit").controller("signupController",["$scope","$state","$firebaseAuth","APIService","$rootScope","UserService",function(t,e,a,r,n,o){t.error=!1,t.errorMessage="";const s=a();t.fbSignup=function(){FB.login(function(t){if(!t.authResponse)return;const a=t.authResponse.accessToken,n=firebase.auth.FacebookAuthProvider.credential(a);s.$signInWithCredential(n).then(function(a){firebase.database().ref("users/"+a.uid).set({email:a.email,firebaseToken:a.firebaseToken,uid:a.uid});const n={email:a.email,name:a.displayName,firebaseToken:a.refreshToken,uid:a.uid,fbId:t.authResponse.userID};r.call_post("user/register/facebook",n).then(function(t){if(200==t.status&&!0===t.data.success){n.access_token=t.data.token,o.setCurrentUser(n);var a={};r.call_get("user/me").then(function(t){200==t.status&&(a.data=t.data,n.name=t.data.name,o.setCurrentUser(n),e.go("navbar",a))}).catch(function(t){})}}).catch(function(t){})}).catch(function(t){})},{scope:"email"})},t.submit=function(){s.$createUserWithEmailAndPassword(t.form.email,t.form.password).then(function(a){firebase.database().ref("users/"+a.uid).set({email:t.form.email,firebaseToken:a.refreshToken,uid:a.uid});const n={email:t.form.email,password:t.form.password,name:t.form.name,firebaseToken:a.refreshToken,uid:a.uid};r.call_post("user/register",n).then(function(t){if(200==t.status&&!0===t.data.success){n.access_token=t.data.token,o.setCurrentUser(n);var a={};r.call_get("user/me").then(function(t){200==t.status&&(a.data=t.data,n.name=t.data.name,o.setCurrentUser(n),e.go("navbar",a))}).catch(function(t){})}}).catch(function(t){})}).catch(function(e){t.error=!0,t.errorMessage=e.message})}}]),(app=angular.module("pakit")).controller("view1Controller",["$scope","$stateParams",function(t,e){t.currUser={},t.users=e.data,t.currUser=t.users[0]||{},t.showUser=function(e){t.currUser=e}}]);